<!doctype html>
<html
  lang="en-us"
  
>
  <head>
    <meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>







  

<title>
  Is unique_ptr Really Zero-Cost? | NothingToSay0031
</title>
<meta
  name="description"
  content="The Hidden Overhead of unique_ptr: Why It&#39;s Not Always Zero-Cost."
/>










<script>
  window.siteConfig = JSON.parse("{\"anchor_icon\":null,\"clipboard\":{\"copyright\":{\"content\":\"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！\",\"count\":50,\"enable\":false},\"fail\":\"复制失败 (ﾟ⊿ﾟ)ﾂ\",\"success\":\"复制成功(*^▽^*)\"},\"code_block\":{\"expand\":true},\"icon_font\":\"4552607_tq6stt6tcg\",\"outdate\":{\"daysago\":180,\"enable\":false,\"message\":\"本文最后更新于 {time}，请注意文中内容可能已经发生变化。\"}}");
</script>











  
  
  
    
  

  
  
  
    
  

  
    

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  rel="preload"
  as="style"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
/>
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"
  media="print"
  onload="this.media='all'"
/>






  <link
    rel="preload"
    href="//at.alicdn.com/t/c/font_4552607_tq6stt6tcg.woff2"
    as="font"
    type="font/woff2"
    crossorigin="anonymous"
  />



  







  
 <link rel="stylesheet" href="https://nothingtosay0031.github.io/css/loader.min.2ad0e9bbffb534e893c0ecefc44787a277cf851387e8ad9dccfbc3a5f0886dbe.css" />




  <meta property="og:type" content="website" />
  <meta property="og:title" content="Is unique_ptr Really Zero-Cost? | NothingToSay0031" />
  <meta
    property="og:description"
    content="The Hidden Overhead of unique_ptr: Why It&#39;s Not Always Zero-Cost."
  />
  <meta property="og:url" content="https://nothingtosay0031.github.io/post/unique/" />
  <meta
    property="og:site_name"
    content="NothingToSay0031"
  />
  <meta
    property="og:image"
    content="/"
  />
  <meta property="article:author" content="NothingToSay0031" />
  <meta property="article:published_time" content="2025-04-27T12:29:00&#43;00:00" />
  <meta property="article:modified_time" content="2025-04-27T12:29:00&#43;00:00" />
  
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:image" content="/" />
  
  
  
  
  




<link rel="shortcut icon" href="https://nothingtosay0031.github.io/favicon.ico">








  
 <link rel="stylesheet" href="https://nothingtosay0031.github.io/css/main.min.4e3ed4ec96a449612baa01e942ad2e62fab14c5e1e8f6b3eeb13d1cbc2e0dc67.css" />





  <link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css"
    onload="this.onload=null;this.rel='stylesheet'"
  />






  <link
    rel="preload"
    as="style"
    href="https://npm.webcache.cn/katex@0.16.9/dist/katex.min.css"
    onload="this.onload=null;this.rel='stylesheet'"
  />








  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"
    
    
    
    
    integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"
  ></script>





  


  <link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.0/dist/aos.css" />




  </head>
  <body>
    
  <div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi">
        
          <svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
            <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="#ff5252" />
            <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
          M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="#ff5252" />
          </svg>
        
      </div>
      <div class="loading-word">少女祈祷中...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script>


<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


    <div id="container">
      <div id="wrap">
        
<div id="header-nav">
  <nav id="main-nav">
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon rotate'>
          
            
              &#xe62b;
            
          
        </div>
        <a class="main-nav-link" href="https://nothingtosay0031.github.io/">Home</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon rotate'>
          
            
              &#xe62b;
            
          
        </div>
        <a class="main-nav-link" href="https://nothingtosay0031.github.io/archives">Archives</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon rotate'>
          
            
              &#xe62b;
            
          
        </div>
        <a class="main-nav-link" href="https://nothingtosay0031.github.io/about">About</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class='main-nav-icon icon rotate'>
          
            
              &#xe62b;
            
          
        </div>
        <a class="main-nav-link" href="https://nothingtosay0031.github.io/friend">Friend</a>
      </span>
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
    
  </nav>
</div>
<header id="header">
  
    <img fetchpriority="high" src="https://nothingtosay0031.github.io/images/banner.webp" alt="Is unique_ptr Really Zero-Cost?">
  

  <div id="header-outer">
    <div id="header-title">
      
        
        
          
        
  
        
          <a href="https://nothingtosay0031.github.io/" id="logo">
            <h1 data-aos="slide-up">Is unique_ptr Really Zero-Cost?</h1>
          </a>
        
      
  
      
        
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>
        <main id="content">
          
          <section id="main">
  <article
  class="h-entry article"
  itemprop="blogPost"
  itemscope
  itemtype="https://schema.org/BlogPosting"
>
  <div
    class="article-inner"
    data-aos="fade-up"
  >
    <div class="article-meta">
      <div class="article-date">
  <a
    href="https://nothingtosay0031.github.io/post/unique/"
    class="article-date-link"
    data-aos="zoom-in"
  >
    <time datetime="2025-04-27 12:29:00 &#43;0000 UTC" itemprop="datePublished"
      >2025-04-27</time
    >
    <time style="display: none;" id="post-update-time"
      >2025-04-27</time
    >
  </a>
</div>

      <div class="article-category">
  
</div>

    </div>
    <div class="hr-line"></div>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <h1 id="the-hidden-cost-of-stdunique_ptr-why-its-not-always-zero-cost">
<a class="header-anchor" href="#the-hidden-cost-of-stdunique_ptr-why-its-not-always-zero-cost"></a>
The Hidden Cost of <code>std::unique_ptr</code>: Why It&rsquo;s Not Always &ldquo;Zero-Cost&rdquo;
</h1><p><a href="https://youtu.be/rHIkrotSwcc?si=ZZCm9hVf2a0UmMie">CppCon 2019: Chandler Carruth “There Are No Zero-cost Abstractions”</a></p>
<p>One of the most beloved tools in the modern C++ developer&rsquo;s toolbox is <code>std::unique_ptr</code>. It dramatically simplifies resource management, especially memory, using the RAII (Resource Acquisition Is Initialization) paradigm, effectively preventing memory leaks. Many C++ developers operate under the assumption that <code>std::unique_ptr</code> is a &ldquo;zero-cost abstraction&rdquo;—meaning its use incurs no additional runtime performance overhead compared to manually managing raw pointers.</p>
<p>But is that really true? Deeper analysis and compiler output, as highlighted in insightful talks, reveal a more nuanced reality: <strong><code>std::unique_ptr</code> isn&rsquo;t always zero-cost, especially when crossing function API boundaries.</strong></p>
<h2 id="when-stdunique_ptr-is-close-to-zero-cost">
<a class="header-anchor" href="#when-stdunique_ptr-is-close-to-zero-cost"></a>
When <code>std::unique_ptr</code> Is (Close to) Zero-Cost
</h2><p>First, let&rsquo;s be clear: in certain scenarios, <code>std::unique_ptr</code> does come very close to being zero-cost. When you use a <code>unique_ptr</code> <strong>solely within a single function scope</strong> to manage the lifetime of a local resource, modern compilers are typically brilliant at optimization.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">process_data</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">data</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ... use data ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ... more operations ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Memory pointed to by data is automatically released at function end.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// In this case, compared to manual new/delete,
</span></span></span><span class="line"><span class="cl"><span class="c1">// the overhead of unique_ptr is often optimized away.
</span></span></span></code></pre></div><p>In this scenario, <code>unique_ptr</code> provides immense safety and convenience with virtually no runtime performance penalty. The compiler can effectively &ldquo;see through&rdquo; the abstraction and generate machine code very similar (or identical) to manual raw pointer management.</p>
<h2 id="crossing-api-boundaries-where-the-overhead-appears">
<a class="header-anchor" href="#crossing-api-boundaries-where-the-overhead-appears"></a>
Crossing API Boundaries: Where the Overhead Appears
</h2><p>One of the true powers of <code>std::unique_ptr</code> lies in its ability to clearly express ownership transfer at the API level. This is far safer and more explicit than the old style of relying on comments to indicate who is responsible for deleting memory.</p>
<p>Consider the contrast between these two styles:</p>
<p><strong>Old Style (Error-prone):</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">bar</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">ptr</span><span class="p">);</span> <span class="c1">// Does something with ptr within the function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Takes ownership. &lt;--- Relies on comments for critical information!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">baz</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">ptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">ptr</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// foo receives a pointer, doesn&#39;t own it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">ptr</span> <span class="o">&gt;</span> <span class="mi">42</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">bar</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>      <span class="c1">// Pass pointer, no ownership transfer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">baz</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>          <span class="c1">// Call baz; according to the comment, ownership transfers here!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                       <span class="c1">// foo must not use ptr after this call
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p><strong>Modern C++ Style (Safer):</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">bar</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">ptr</span><span class="p">);</span> <span class="c1">// Can still take raw pointers for non-owning access
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// Takes ownership. Explicitly stated via the type system.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">baz</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ptr</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// foo receives ownership
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">ptr</span> <span class="o">&gt;</span> <span class="mi">42</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">bar</span><span class="p">(</span><span class="n">ptr</span><span class="p">.</span><span class="n">get</span><span class="p">());</span> <span class="c1">// Use get() for non-owning raw pointer access
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">baz</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">ptr</span><span class="p">));</span> <span class="c1">// Explicitly transfer ownership to baz using std::move
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                         <span class="c1">// ptr becomes null after this
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>The code on the right is undoubtedly clearer and safer. However, it&rsquo;s precisely when we pass <code>unique_ptr</code> between functions like this (especially via pass-by-value with <code>std::move</code> into <code>baz</code>) that the hidden costs can start to manifest.</p>
<h2 id="analyzing-the-sources-of-overhead">
<a class="header-anchor" href="#analyzing-the-sources-of-overhead"></a>
Analyzing the Sources of Overhead
</h2><p>The speaker analyzed scenarios similar to <code>foo</code> calling <code>baz</code> using Compiler Explorer and found the generated assembly code was surprisingly longer than expected. There are several reasons:</p>
<ol>
<li>
<p><strong>Exception Safety Overhead (Implicit)</strong>:</p>
<ul>
<li>The <code>std::unique_ptr</code> version is inherently exception-safe. If <code>bar</code> or <code>baz</code> throws an exception within <code>foo</code>, the <code>unique_ptr</code>&rsquo;s destructor ensures the memory is correctly freed.</li>
<li>The raw pointer version lacks this guarantee. If <code>bar</code> throws (assuming in the raw pointer version, <code>bar</code> could throw before <code>baz</code> is called), or if <code>baz</code> itself throws before taking ownership, the memory leaks.</li>
<li>To implement this safety guarantee, the compiler generates extra exception handling code (e.g., involving <code>unwind resume</code> instructions), which is itself a form of overhead.</li>
<li><em>Optimization</em>: If you can guarantee that the relevant functions (like <code>bar</code> and <code>baz</code>) will not throw exceptions, you can mark them <code>noexcept</code>. This can eliminate the exception handling overhead, shortening the assembly. But even then, the problem isn&rsquo;t fully solved.</li>
</ul>
</li>
<li>
<p><strong>Pass-by-Value Overhead for <code>unique_ptr</code> (ABI Constraints &amp; Temporaries)</strong>:</p>
<ul>
<li>Even with <code>noexcept</code>, passing a <code>unique_ptr</code> <strong>by value</strong> (even via <code>std::move</code>) is often <strong>not zero-cost</strong>.</li>
<li>According to the C++ ABI (Application Binary Interface) on many platforms, &ldquo;non-trivial&rdquo; types like <code>unique_ptr</code> (because it has custom destructor and move constructor/assignment operators) are <strong>often passed indirectly via memory (the stack)</strong>, even when passed &ldquo;by value&rdquo;, rather than directly in registers.</li>
<li>This results in a sequence of operations:
<ul>
<li>The pointer value inside the <code>unique_ptr</code> is <strong>stored onto the caller&rsquo;s (<code>foo</code>) stack</strong>.</li>
<li>The <strong>address</strong> of this stack location is calculated.</li>
<li>This <strong>address</strong> is passed to the callee (<code>baz</code>).</li>
<li>Inside <code>baz</code>, the function needs to <strong>load</strong> the <code>unique_ptr</code>&rsquo;s contents (the actual pointer value) <strong>through this address</strong>. <strong>This is a double indirection</strong>.</li>
<li>After <code>baz</code> returns, the caller (<code>foo</code>) needs to <strong>load</strong> the value of that (now potentially null) <code>unique_ptr</code> <strong>back from the stack</strong> and check if it needs to call the destructor (because C++ lacks destructive moves, it must assume <code>baz</code> <em>might not</em> have moved from it, even though we used <code>std::move</code>).</li>
</ul>
</li>
<li>These extra memory loads and stores, particularly the double indirection, add instructions and potential memory latency, creating performance overhead.</li>
</ul>
</li>
<li>
<p><strong>Overhead when Trying R-value References (<code>&amp;&amp;</code>)</strong>:</p>
<ul>
<li>One might think: could using an r-value reference parameter <code>void baz(std::unique_ptr&lt;int&gt;&amp;&amp; ptr)</code> solve this?</li>
<li>It does avoid some of the temporary object copy/move and stack-based destructor checks associated with pass-by-value. The generated assembly looks closer to the raw pointer version.</li>
<li><strong>However</strong>, it introduces an <strong>explicit double indirection</strong>: you&rsquo;re passing a reference <em>to</em> a <code>unique_ptr</code>, which itself contains a pointer. This still results in two memory load operations (<code>load from memory</code> instructions) in the critical path, which are subject to memory subsystem latency and can be slower than the raw pointer version (which often involves only one load).</li>
</ul>
</li>
</ol>
<h2 id="why-cant-the-compiler-do-better">
<a class="header-anchor" href="#why-cant-the-compiler-do-better"></a>
Why Can&rsquo;t the Compiler Do Better?
</h2><p>Eliminating these overheads is extremely difficult because it touches fundamental C++ mechanisms:</p>
<ul>
<li><strong>ABI Stability Constraints</strong>: Changing function calling conventions (e.g., allowing small objects like <code>unique_ptr</code> to be passed in registers) is a massive ABI break, shattering compatibility with existing compiled code. It&rsquo;s practically very difficult to implement widely.</li>
<li><strong>Lack of Destructive Move Semantics</strong>: C++ move semantics are non-destructive. After a move, the source object still exists in a valid (usually empty) state, and its destructor will still be called. If C++ had destructive moves, the compiler would know the source object needs no further checks or destruction after being moved, potentially eliminating some overhead. But this would be a fundamental change to the language semantics. (Rust wins! XD)</li>
</ul>
<h2 id="conclusion-understanding-the-trade-offs">
<a class="header-anchor" href="#conclusion-understanding-the-trade-offs"></a>
Conclusion: Understanding the Trade-offs
</h2><p><code>std::unique_ptr</code> is an incredibly valuable tool. The memory safety, clear ownership semantics, and exception safety it provides usually far outweigh its potential performance overhead.</p>
<ul>
<li><strong>When used locally within a function, it&rsquo;s typically zero-cost.</strong></li>
<li><strong>When transferring ownership across function API boundaries, due to ABI limitations and the nature of C++ move semantics, it can introduce runtime overhead</strong> (memory loads/stores, double indirection, potential destructor checks).</li>
</ul>
<p>The key is to <strong>understand this trade-off</strong>. For the vast majority of applications, the benefits of <code>unique_ptr</code> in safety and code clarity are paramount, and the slight performance difference is often negligible. However, in extremely performance-sensitive code paths (e.g., low-level libraries, high-frequency functions), developers should be aware that <code>unique_ptr</code> might not be strictly &ldquo;zero-cost&rdquo; in these specific scenarios. Knowing these details can help you make informed decisions during performance tuning, but it absolutely does not mean we should revert wholesale to error-prone manual pointer management.</p>
<p><strong><code>std::unique_ptr</code> remains the preferred way to manage dynamic memory in modern C++. Just remember that powerful abstractions sometimes come with subtle costs.</strong></p>

      
    </div>
    <footer class="article-footer">
      

      

      

      

      

      

      
      <ul class="article-tag-list" itemprop="keywords">
  
</ul>

    </footer>
  </div>
  
    
  <nav
    id="article-nav"
    data-aos="fade-up"
  >
    
      <div class="article-nav-link-wrap article-nav-link-left">
        
          
          
            <img
              data-src="https://raw.githubusercontent.com/NothingToSay0031/Images/main/202412220910052.png"
              data-sizes="auto"
              alt="ReSTIR: Path Reuse in Real-time"
              class="lazyload"
            />
          
        
        <a href="https://nothingtosay0031.github.io/post/restir/"></a>
        <div class="article-nav-caption">Newer</div>
        <h3 class="article-nav-title">
          
            ReSTIR: Path Reuse in Real-time
          
        </h3>
      </div>
    

    
      <div class="article-nav-link-wrap article-nav-link-right">
        
          
          
            <img
              data-src="https://raw.githubusercontent.com/NothingToSay0031/Images/main/202412220910052.png"
              data-sizes="auto"
              alt="Ultimate Guide to Profiling Unity Games"
              class="lazyload"
            />
          
        
        <a href="https://nothingtosay0031.github.io/post/profilingunity/"></a>
        <div class="article-nav-caption">Older</div>
        <h3 class="article-nav-title">
          
            Ultimate Guide to Profiling Unity Games
          
        </h3>
      </div>
    
  </nav>


  
</article>










</section>
          
            <aside id="sidebar">
  <div class="sidebar-wrapper wrap-sticky">
    <div
      class="sidebar-wrap"
      data-aos="fade-up"
    >
      
        <div class="sidebar-toc-sidebar">
          <div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#the-hidden-cost-of-stdunique_ptr-why-its-not-always-zero-cost">The Hidden Cost of <code>std::unique_ptr</code>: Why It&rsquo;s Not Always &ldquo;Zero-Cost&rdquo;</a>
      <ul>
        <li><a href="#when-stdunique_ptr-is-close-to-zero-cost">When <code>std::unique_ptr</code> Is (Close to) Zero-Cost</a></li>
        <li><a href="#crossing-api-boundaries-where-the-overhead-appears">Crossing API Boundaries: Where the Overhead Appears</a></li>
        <li><a href="#analyzing-the-sources-of-overhead">Analyzing the Sources of Overhead</a></li>
        <li><a href="#why-cant-the-compiler-do-better">Why Can&rsquo;t the Compiler Do Better?</a></li>
        <li><a href="#conclusion-understanding-the-trade-offs">Conclusion: Understanding the Trade-offs</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
        </div>
        <div class="sidebar-common-sidebar hidden">
          
<div class="sidebar-author">
  <img
    data-src="https://nothingtosay0031.github.io/avatar/../avatar.webp"
    data-sizes="auto"
    alt="NothingToSay0031"
    class="lazyload"
  />
  <div class="sidebar-author-name">NothingToSay0031</div>
  <div class="sidebar-description">又是一个做水果蛋糕的好天气啊！</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div>
    
    <div class="sidebar-state-number">19</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">
      0
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">0</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-email sidebar-social-icon">
      <a
        href="mailto:jhwzju@gmail.com"
        itemprop="url"
        target="_blank"
        aria-label="email"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-github sidebar-social-icon">
      <a
        href="https://github.com/NothingToSay0031"
        itemprop="url"
        target="_blank"
        aria-label="github"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-linkedin sidebar-social-icon">
      <a
        href="https://www.linkedin.com/in/hongweiji"
        itemprop="url"
        target="_blank"
        aria-label="linkedin"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="https://nothingtosay0031.github.io/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">Home</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="https://nothingtosay0031.github.io/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">Archives</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="https://nothingtosay0031.github.io/about"
        aria-label="About"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">About</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="https://nothingtosay0031.github.io/friend"
        aria-label="Friend"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">Friend</div>
    </div>
  
</div>

        </div>
      

      
        <div class="sidebar-btn-wrapper" style="position:static">
          <div class="sidebar-toc-btn current"></div>
          <div class="sidebar-common-btn"></div>
        </div>
      
    </div>
  </div>

  
</aside>

          
        </main>
        



  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  



<footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    <div>
      <span class="icon-copyright"></span>
      2021 -
      2025
      <span class="footer-info-sep rotate"></span>
      NothingToSay0031
    </div>
    
      <div>
        Powered by&nbsp;<a
          href="https://gohugo.io/"
          target="_blank"
          >Hugo</a
        >&nbsp; Theme.<a
          href="https://github.com/D-Sketon/hugo-theme-reimu"
          target="_blank"
          >Reimu</a
        >
      </div>
    
    
      <div>
        <span class="icon-brush"
          >&nbsp;
            49.7k
          </span
        >
        &nbsp;|&nbsp;
        <span class="icon-coffee">&nbsp;
          
          

          04:04
        </span>
      </div>
    
    
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv"
          >Number of visits&nbsp;<span
            id="busuanzi_value_site_pv"
          ></span
        ></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv"
          >Number of visitors&nbsp;<span
            id="busuanzi_value_site_uv"
          ></span
        ></span>
      </div>
    
  </div>
</footer>

        
          <div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div>
        
        <div id="mask" class="hide"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      <div class="sidebar-toc-sidebar">
        <div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#the-hidden-cost-of-stdunique_ptr-why-its-not-always-zero-cost">The Hidden Cost of <code>std::unique_ptr</code>: Why It&rsquo;s Not Always &ldquo;Zero-Cost&rdquo;</a>
      <ul>
        <li><a href="#when-stdunique_ptr-is-close-to-zero-cost">When <code>std::unique_ptr</code> Is (Close to) Zero-Cost</a></li>
        <li><a href="#crossing-api-boundaries-where-the-overhead-appears">Crossing API Boundaries: Where the Overhead Appears</a></li>
        <li><a href="#analyzing-the-sources-of-overhead">Analyzing the Sources of Overhead</a></li>
        <li><a href="#why-cant-the-compiler-do-better">Why Can&rsquo;t the Compiler Do Better?</a></li>
        <li><a href="#conclusion-understanding-the-trade-offs">Conclusion: Understanding the Trade-offs</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
      </div>
      <div class="sidebar-common-sidebar hidden">
        
<div class="sidebar-author">
  <img
    data-src="https://nothingtosay0031.github.io/avatar/../avatar.webp"
    data-sizes="auto"
    alt="NothingToSay0031"
    class="lazyload"
  />
  <div class="sidebar-author-name">NothingToSay0031</div>
  <div class="sidebar-description">又是一个做水果蛋糕的好天气啊！</div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div>
    
    <div class="sidebar-state-number">19</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">
      0
    </div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">0</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-email sidebar-social-icon">
      <a
        href="mailto:jhwzju@gmail.com"
        itemprop="url"
        target="_blank"
        aria-label="email"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-github sidebar-social-icon">
      <a
        href="https://github.com/NothingToSay0031"
        itemprop="url"
        target="_blank"
        aria-label="github"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
    <div class="icon-linkedin sidebar-social-icon">
      <a
        href="https://www.linkedin.com/in/hongweiji"
        itemprop="url"
        target="_blank"
        aria-label="linkedin"
        rel="noopener external nofollow noreferrer"
      ></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="https://nothingtosay0031.github.io/"
        aria-label="Home"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">Home</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="https://nothingtosay0031.github.io/archives"
        aria-label="Archives"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">Archives</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="https://nothingtosay0031.github.io/about"
        aria-label="About"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">About</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a
        class="sidebar-menu-link-dummy"
        href="https://nothingtosay0031.github.io/friend"
        aria-label="Friend"
      ></a>
      <div class='sidebar-menu-icon icon rotate'>
        
          
            &#xe62b;
          
        
      </div>
      <div class="sidebar-menu-link">Friend</div>
    </div>
  
</div>

      </div>
    
  </div>
  
    <div class="sidebar-btn-wrapper">
      <div class="sidebar-toc-btn current"></div>
      <div class="sidebar-common-btn"></div>
    </div>
  
</nav>

    </div>
    
    






  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"
    
    
    
    
    integrity="sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf&#43;e" crossorigin="anonymous"
  ></script>




  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"
    
    
    
    
    integrity="sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"
  ></script>









  
      
      <script src="https://nothingtosay0031.github.io/js/main.js" integrity="" crossorigin="anonymous" ></script>
      



  





  
      
      <script src="https://nothingtosay0031.github.io/js/aos.js" integrity="" crossorigin="anonymous" ></script>
      

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", aosInit);
    } else {
      aosInit();
    }
  </script>








  
      
      <script src="https://nothingtosay0031.github.io/js/pjax_main.js" integrity="" crossorigin="anonymous" data-pjax></script>
      





  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/mouse-firework@0.0.6/dist/index.umd.js"
    
    
    
    
    integrity="sha384-vkGvf25gm1C1PbcoD5dNfc137HzNL/hr1RKA5HniJOaawtvUmH5lTVFgFAruE9Ge" crossorigin="anonymous"
  ></script>


<script>
  if (window.firework) {
    const options = JSON.parse("{\"excludeelements\":[\"a\",\"button\"],\"particles\":[{\"colors\":[\"#ff5252\",\"#ff7c7c\",\"#ffafaf\",\"#ffd0d0\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"emit\"],\"number\":20,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.3,0.5],\"radius\":[16,32]}},{\"colors\":[\"#ff0000\"],\"duration\":[1200,1800],\"easing\":\"easeOutExpo\",\"move\":[\"diffuse\"],\"number\":1,\"shape\":\"circle\",\"shapeOptions\":{\"alpha\":[0.2,0.5],\"lineWidth\":6,\"radius\":20}}]}");
    options.excludeElements = options.excludeelements;
    delete options.excludeelements;
    window.firework(options);
  }
</script>








<div id="lazy-script">
  <div>
    
    
      





  
      
      <script src="https://nothingtosay0031.github.io/js/insert_highlight.js" integrity="" crossorigin="anonymous" data-pjax></script>
      

      
      
      
      
      <script type="module" data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;

        const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script>
      












    
    
  </div>
</div>




  

  
  
  
  
  
  
  <script
    src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js"
    
    async
    
    
    integrity="sha384-0M75wtSkhjIInv4coYlaJU83&#43;OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id&#43;S" crossorigin="anonymous"
  ></script>





  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then((registrations) => {
        for (let registration of registrations) {
          registration.unregister();
        }
      });
    }
  </script>


<script>
  const reimuCopyright = String.raw`
   ______     ______     __     __    __     __  __    
  /\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
  \ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
   \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
    \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                    
  `;
  console.log(String.raw`%c ${reimuCopyright}`, "color: #ff5252;");
  console.log(
    "%c Theme.Reimu" + " %c https://github.com/D-Sketon/hugo-theme-reimu ",
    "color: white; background: #ff5252; padding:5px 0;",
    "padding:4px;border:1px solid #ff5252;",
  );
</script>

  </body>
</html>
